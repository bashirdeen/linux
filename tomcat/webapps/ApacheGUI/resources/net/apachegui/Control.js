//>>built
define("net/apachegui/Control","dojo/_base/declare dojo/dom dijit/registry dojo/on dojo/request dojo/_base/array dojo/data/ItemFileWriteStore dijit/form/Button dojo/_base/json".split(" "),function(k,d,c,f,e,l,h,g,m){k("net.apachegui.Control",null,{currentControlMenuId:null,refreshTimerHandler:null,currentExtendedStatus:!1,initialized:!1,startButton:null,stopButton:null,restartButton:null,serverState:null,processesStore:null,extendedProcessesStore:null,extendedError:!1,init:function(){if(!1===this.initialized){var a=
this;this.checkProcessCommand();this.checkExtendedStatusRestart()&&this.isExtendedStatusEnabled()&&this.updateExtendedStatus(!1);this.addListeners();this.updateProcessInfoButton();this.isServerRunning(function(){a.displayServerStarted();a.setRefreshTimer()},function(){a.displayServerStopped();a.setRefreshTimer()});this.initialized=!0}},setCurrentMenuId:function(a){this.currentControlMenuId=a.toString()},getCurrentMenuId:function(){return this.currentControlMenuId},isServerRunning:function(a,b){e.get("../web/Control",
{query:{option:"isServerRunning"},handleAs:"json",sync:!1,preventCache:!0}).response.then(function(d){!0==d.data.result?a&&a():b&&b()},function(a){net.apachegui.Util.alert("Info",a.response.data.message)})},checkProcessCommand:function(){e.get("../web/Control",{query:{option:"checkProcessCommand"},handleAs:"json",preventCache:!0,sync:!0}).response.then(function(a){},function(a){net.apachegui.Util.alert("Info",a.response.data.message)})},setRefreshTimer:function(){net.apachegui.Interval.clearInterval(this.refreshTimerHandler);
var a=1E3*d.byId("processInfoRefreshRate").value;0<a&&(this.refreshTimerHandler=net.apachegui.Interval.setInterval(this.refreshProcessInfo.bind(this),a))},refreshProcessInfo:function(){var a=this;this.isServerRunning(function(){a.displayServerStarted();a.refreshStandardProcessInfo();a.isExtendedStatusEnabled()&&(a.refreshExtendedServerInfo(),a.refreshExtendedProcessInfo())},function(){a.displayServerStopped()})},refreshStandardProcessInfo:function(){var a=this;e.get("../web/Control",{query:{option:"runningProcesses"},
handleAs:"json",preventCache:!0,sync:!1}).response.then(function(b){b=b.data;a.processesStore.fetch({query:{pid:"*"},onItem:function(b){null!=b&&(a.processesStore.deleteItem(b),a.processesStore.save())}});for(var d in b.items){var c=b.items[d];a.processesStore.newItem({id:c.id,uid:c.uid,pid:c.pid,ppid:c.ppid,cpuTime:c.cpuTime,command:c.command})}},function(a){net.apachegui.Util.alert("Info",a.response.data.message)})},refreshExtendedServerInfo:function(){e.get("../web/Control",{query:{option:"extendedServerInfo"},
handleAs:"json",preventCache:!0,sync:!1}).response.then(function(a){a=a.data;d.byId("totalRequests").innerHTML=a.totalRequests;d.byId("totalKB").innerHTML=a.totalKB;net.apachegui.Main.getInstance().isWindows()||(d.byId("cpuUsage").innerHTML=a.cpuUsage);d.byId("upTime").innerHTML=a.upTime;d.byId("requestsPerSecond").innerHTML=a.requestsPerSecond;d.byId("bytesPerSecond").innerHTML=a.bytesPerSecond;d.byId("bytesPerRequest").innerHTML=a.bytesPerRequest;d.byId("busyWorkers").innerHTML=a.busyWorkers;d.byId("idleWorkers").innerHTML=
a.idleWorkers},function(a){that.extendedError||(that.extendedError=!0)})},refreshExtendedProcessInfo:function(){var a=this;e.get("../web/Control",{query:{option:"extendedRunningProcesses"},handleAs:"json",preventCache:!0,sync:!1}).response.then(function(b){b=b.data;a.extendedProcessesStore.fetch({query:{id:"*"},onItem:function(b){null!=b&&(a.extendedProcessesStore.deleteItem(b),a.extendedProcessesStore.save())}});for(var d in b.items){var c=b.items[d];a.extendedProcessesStore.newItem({id:c.id,extendedPid:c.extendedPid,
extendedRequests:c.extendedRequests,extendedCpu:c.extendedCpu,extendedTimeSinceLastRequest:c.extendedTimeSinceLastRequest,extendedTimeToProcessLastRequest:c.extendedTimeToProcessLastRequest,extendedMegaBytesThisConnection:c.extendedMegaBytesThisConnection,extendedClient:c.extendedClient,extendedVirtualHost:c.extendedVirtualHost,extendedRequest:c.extendedRequest})}},function(b){a.extendedError||(a.extendedError=!0)})},updateProcessInfo:function(){var a=this;e.post("../web/Control",{data:{option:"updateProcessInfo",
processInfoRefreshRate:d.byId("processInfoRefreshRate").value,off:d.byId("processInfoRefreshRatecb").checked},handleAs:"json",sync:!0}).response.then(function(b){b=b.data.result;0==b?(d.byId("processInfoRefreshRateDisplay").innerHTML="(Refresh Off)",d.byId("processInfoRefreshRatecb").checked=!0,c.byId("processInfoRefreshRate").set("disabled",!0)):(d.byId("processInfoRefreshRateDisplay").innerHTML="(Refresh "+b+" Seconds)",d.byId("processInfoRefreshRatecb").checked=!1,c.byId("processInfoRefreshRate").set("disabled",
!1));c.byId("processInfoRefreshRate").set("value",b);a.setRefreshTimer()},function(a){net.apachegui.Util.alert("Info",a.response.data.message)})},updateExtendedStatus:function(a){var b=this,c="",c=a?a:d.byId("extendedStatusToggle").checked;e.post("../web/Control",{data:{option:"updateExtendedStatus",extendedStatus:c},handleAs:"json",sync:!0}).response.then(function(a){a=a.data;"on"==a.result?(d.byId("extendedStatusToggle").checked=!0,!0==a.change&&"started"==b.serverState&&(b.buildExtendedServerInfo(),
b.buildExtendedProcessGrid())):(d.byId("extendedStatusToggle").checked=!1,!0==a.change&&"started"==b.serverState&&(b.destroyExtendedServerInfo(),b.destroyExtendedProcessGrid()))},function(a){net.apachegui.Util.alert("Info",a.response.data.message)})},updateProcessInfoButton:function(){this.isExtendedStatusEnabled()?d.byId("extendedStatusToggle").checked=!0:d.byId("extendedStatusToggle").checked=!1;var a=this.getRefreshRate();0==a?(d.byId("processInfoRefreshRateDisplay").innerHTML="(Refresh Off)",
c.byId("processInfoRefreshRate").set("disabled",!0),d.byId("processInfoRefreshRatecb").checked=!0):(d.byId("processInfoRefreshRateDisplay").innerHTML="(Refresh "+a+" Seconds)",c.byId("processInfoRefreshRate").set("disabled",!1),d.byId("processInfoRefreshRatecb").checked=!1);c.byId("processInfoRefreshRate").set("value",a)},extendedStatusModuleCheck:function(){var a=this;!0==d.byId("extendedStatusToggle").checked&&!1==this.isExtendedStatusEnabled()&&e.get("../web/Control",{query:{option:"checkExtendedStatusModule"},
handleAs:"json",sync:!0,preventCache:!0}).response.then(function(b){!1==b.data.result?(d.byId("extendedStatusToggle").checked=!1,net.apachegui.Util.alert("status_module not available","Turning on extended status requires that the status_module is loaded into apache.\x3cBR/\x3e This module is not currently loaded and is not in the available modules folder.")):a.extendedStatusRestartWarning()},function(a){net.apachegui.Util.alert("Error",a.response.data.message);d.byId("extendedStatusToggle").checked=
!1})},extendedStatusRestartWarning:function(){"stopped"!=this.serverState&&!0==d.byId("extendedStatusToggle").checked&&!1==this.isExtendedStatusEnabled()&&!0==this.checkExtendedStatusRestart()&&net.apachegui.Util.alert("Turn On Extended Status","Turning on extended status requires a server restart.\x3cBR/\x3e The server will restart after you submit this change!")},checkExtendedStatusRestart:function(){var a=!1;e.get("../web/Control",{query:{option:"checkExtendedStatusRestart"},handleAs:"json",sync:!0,
preventCache:!0}).response.then(function(b){a=b.data.result},function(a){net.apachegui.Util.alert("Error",a.response.data.message)});return a},initProcessMenu:function(){var a=this;net.apachegui.Util.confirmDialog("Kill Process","Do you want to kill process "+this.currentControlMenuId+"?",function(b){b&&a.killProcess(a.currentControlMenuId)})},killProcess:function(a){var b=this,c=net.apachegui.Util.noCloseDialog("Killing","Killing Process Please Wait...");c.show();e.post("../web/Control",{data:{option:"killProcess",
pid:a},handleAs:"json",sync:!1}).response.then(function(a){b.refreshProcessInfo();c.remove()},function(a){c.remove();net.apachegui.Util.alert("Error",a.response.data.message)})},isExtendedStatusEnabled:function(){var a=!1;e.get("../web/Control",{query:{option:"isExtendedStatusEnabled"},handleAs:"json",sync:!0,preventCache:!0}).response.then(function(b){a=b.data.result},function(a){net.apachegui.Util.alert("Error",a.response.data.message)});return a},getRefreshRate:function(){var a=0;e.get("../web/Control",
{query:{option:"getRefreshRate"},handleAs:"json",sync:!0,preventCache:!0}).response.then(function(b){a=b.data.result},function(a){net.apachegui.Util.alert("Error",a.response.data.message)});return a},startServer:function(){var a=this,b=net.apachegui.Util.noCloseDialog("Starting","Starting Please Wait...");b.show();e.post("../web/Control",{data:{option:"startServer"},handleAs:"json",sync:!1}).response.then(function(d){c.byId("startApacheForm").hide();a.displayServerStarted();b.remove()},function(a){b.remove();
net.apachegui.Util.alert("Error",a.response.data.message)})},restartServer:function(){var a=this,b=net.apachegui.Util.noCloseDialog("Restarting","Restarting Please Wait...");b.show();e.post("../web/Control",{data:{option:"restartServer"},handleAs:"json",sync:!1}).response.then(function(d){c.byId("restartApacheForm").hide();a.refreshProcessInfo();b.remove()},function(a){b.remove();net.apachegui.Util.alert("Error",a.response.data.message)})},stopServer:function(){var a=this,b=net.apachegui.Util.noCloseDialog("Stopping",
"Stopping Please Wait...");b.show();e.post("../web/Control",{data:{option:"stopServer"},handleAs:"json",sync:!1}).response.then(function(d){c.byId("stopApacheForm").hide();a.displayServerStopped();b.remove()},function(a){b.remove();net.apachegui.Util.alert("Error",a.response.data.message)})},displayServerStarted:function(){if(null==this.serverState||"stopped"==this.serverState)d.byId("runningStatusDiv").innerHTML='\x3ctable\x3e\x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cspan class\x3d"running"\x3eRUNNING\x3c/span\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3cimg alt\x3d"Apache Logo" src\x3d"../resources/images/green.png"/\x3e\x3c/td\x3e\x3ctd id\x3d"restartStopButtonCol" valign\x3d"middle"\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e',
d.byId("restartStopButtonCol").appendChild(this.restartButton.domNode),d.byId("restartStopButtonCol").appendChild(this.stopButton.domNode),this.buildProcessGrid(),this.isExtendedStatusEnabled()&&(this.buildExtendedServerInfo(),this.buildExtendedProcessGrid()),this.serverState="started"},displayServerStopped:function(){if(null==this.serverState||"started"==this.serverState)d.byId("runningStatusDiv").innerHTML='\x3ctable\x3e\x3ctr\x3e\x3ctd colspan\x3d"2"\x3e\x3cspan class\x3d"stopped"\x3eSTOPPED\x3c/span\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3cimg alt\x3d"Apache Logo" src\x3d"../resources/images/red.png"/\x3e\x3c/td\x3e\x3ctd id\x3d"startButtonCol" valign\x3d"middle"\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e',
d.byId("startButtonCol").appendChild(this.startButton.domNode),this.destroyProcessGrid(),this.isExtendedStatusEnabled()&&(this.destroyExtendedServerInfo(),this.destroyExtendedProcessGrid()),this.serverState="stopped"},buildProcessGrid:function(){var a=this;this.processesStore=new h({url:"../web/Control?option\x3drunningProcesses",urlPreventCache:!0,clearOnClose:!0});var b=new dojox.grid.DataGrid({id:"processesGrid",store:this.processesStore,structure:[[{field:"uid",name:"UID",width:"auto"},{field:"pid",
name:"Process ID",width:"auto"},{field:"ppid",name:"Process Parent ID",width:"auto"},{field:"cpuTime",name:"CPU Time",width:"auto"},{field:"command",name:"Command",width:"auto"}]],selectable:!0,style:"width:100%;",autoHeight:!0,rowSelector:"20px"});d.byId("processInfoContainer").innerHTML='\x3cdiv class\x3d"dijitDialogPaneContentArea"\x3e\x3ch3\x3eCurrent Process Information\x3c/h3\x3e\x3c/div\x3e';d.byId("processInfoContainer").appendChild(b.domNode);b.startup();b.onRowContextMenu=function(c){var d=
b.getItem(c.rowIndex);l.forEach(b.store.getAttributes(d),function(c){var e=b.store.getValues(d,c);"pid"==c&&a.setCurrentMenuId(e)})};c.byId("processes_menu").bindDomNode(b.domNode)},destroyProcessGrid:function(){null!=this.serverState&&(c.byId("processesGrid").destroyRecursive(),d.byId("processInfoContainer").innerHTML="")},buildExtendedServerInfo:function(){d.byId("extendedServerInfoContainer").style.display="block";this.refreshExtendedServerInfo()},destroyExtendedServerInfo:function(){null!=this.serverState&&
(d.byId("extendedServerInfoContainer").style.display="none")},buildExtendedProcessGrid:function(){this.extendedProcessesStore=new h({url:"../web/Control?option\x3dextendedRunningProcesses",urlPreventCache:!0,clearOnClose:!0});var a;a=net.apachegui.Main.getInstance().isWindows()?[[{field:"extendedPid",name:"PID",width:"auto"},{field:"extendedRequests",name:"REQ",width:"auto"},{field:"extendedTimeSinceLastRequest",name:"Last REQ Time",width:"auto"},{field:"extendedTimeToProcessLastRequest",name:"Last REQ Dur",
width:"auto"},{field:"extendedMegaBytesThisConnection",name:"MEG",width:"auto"},{field:"extendedClient",name:"Client",width:"auto"},{field:"extendedVirtualHost",name:"Virtual Host",width:"auto"},{field:"extendedRequest",name:"Request",width:"auto"}]]:[[{field:"extendedPid",name:"PID",width:"auto"},{field:"extendedRequests",name:"REQ",width:"auto"},{field:"extendedCpu",name:"CPU",width:"auto"},{field:"extendedTimeSinceLastRequest",name:"Last REQ Time",width:"auto"},{field:"extendedTimeToProcessLastRequest",
name:"Last REQ Dur",width:"auto"},{field:"extendedMegaBytesThisConnection",name:"MEG",width:"auto"},{field:"extendedClient",name:"Client",width:"auto"},{field:"extendedVirtualHost",name:"Virtual Host",width:"auto"},{field:"extendedRequest",name:"Request",width:"auto"}]];a=new dojox.grid.DataGrid({id:"extendedProcessesGrid",store:this.extendedProcessesStore,structure:a,selectable:!0,style:"width:100%;",autoHeight:!0,rowSelector:"20px"});d.byId("extendedProcessInfoContainer").appendChild(a.domNode);
a.startup();d.byId("extendedProcessInfoTable").style.display="block"},destroyExtendedProcessGrid:function(){null!=this.serverState&&(c.byId("extendedProcessesGrid").destroyRecursive(),d.byId("extendedProcessInfoTable").style.display="none")},addListeners:function(){var a=this;f(c.byId("killProcessMenuItem"),"click",function(){a.initProcessMenu()});f(c.byId("cancelStartApacheButton"),"click",function(){c.byId("startApacheForm").hide()});f(c.byId("startApacheButton"),"click",function(){a.startServer()});
f(c.byId("cancelRestartApacheButton"),"click",function(){c.byId("restartApacheForm").hide()});f(c.byId("restartApacheButton"),"click",function(){a.restartServer()});f(c.byId("cancelStopApacheButton"),"click",function(){c.byId("stopApacheForm").hide()});f(c.byId("stopApacheButton"),"click",function(){a.stopServer()});f(c.byId("processSettingsShow"),"click",function(){c.byId("processSettingsForm").show()});f(d.byId("extendedStatusToggle"),"change",function(){a.extendedStatusModuleCheck()});f(d.byId("processInfoRefreshRatecb"),
"change",function(){!0==d.byId("processInfoRefreshRatecb").checked?c.byId("processInfoRefreshRate").set("disabled",!0):c.byId("processInfoRefreshRate").set("disabled",!1)});f(c.byId("hideProcessSettings"),"click",function(){a.updateProcessInfoButton();c.byId("processSettingsForm").hide()});f(c.byId("submitProcessSettings"),"click",function(){a.updateProcessInfo();a.updateExtendedStatus();c.byId("processSettingsForm").hide()});this.startButton=new g({label:"Start",onClick:function(){c.byId("startApacheForm").show()}});
this.stopButton=new g({label:"Stop",onClick:function(){c.byId("stopApacheForm").show()}});this.restartButton=new g({label:"Restart",onClick:function(){c.byId("restartApacheForm").show()}})}});net.apachegui.Util.setupSingletonInstance(net.apachegui.Control)});