//>>built
define("net/apachegui/Logs","dojo/_base/declare dojo/dom dijit/registry dojo/on dojo/request dojo/_base/json".split(" "),function(g,d,b,c,e,k){g("net.apachegui.Logs",null,{searchTextArea:null,tailTextArea:null,currByte:"0",initialized:!1,isTailing:!1,optionInit:null,currOption:null,init:function(){!1===this.initialized&&(this.addListeners(),this.initialized=!0)},getSearchTextArea:function(){return this.searchTextArea},setSearchTextArea:function(a){this.searchTextArea=a},getTailTextArea:function(){return this.tailTextArea},
setTailTextArea:function(a){this.tailTextArea=a},setCurrOption:function(a){this.currOption=a},updateSelection:function(){var a=b.byId("logAction").get("value");"search"==a&&(null==this.optionInit&&b.byId("logTailDiv").set("style",{display:"none"}),null!=this.optionInit&&"search"!=this.currOption&&(window.location.href="Logs.jsp?file\x3d"+net.apachegui.Util.getQueryParam("file")+"\x26option\x3dsearch"));"download"==a&&window.open("../web/DownloadFile?file\x3d"+d.byId("filePath").innerHTML);"tail"==
a&&(null==this.optionInit&&b.byId("logSearchDiv").set("style",{display:"none"}),null!=this.optionInit&&"tail"!=this.currOption&&(window.location.href="Logs.jsp?file\x3d"+net.apachegui.Util.getQueryParam("file")+"\x26option\x3dtail"));this.optionInit=!0},search:function(){var a=this,b=net.apachegui.Util.getQueryParam("file"),h=d.byId("searchFilter").value,f=net.apachegui.Util.noCloseDialog("Generating","Searching Please Wait...");f.show();e.get("../web/Logs",{query:{option:"search",searchFilter:h,
file:b},handleAs:"text",preventCache:!0,sync:!1}).response.then(function(b){b=b.data;a.getSearchTextArea().setValue(b);a.getSearchTextArea().setOption("lineNumbers",!0);f.remove()},function(a){f.remove();net.apachegui.Util.alert("Info",a.response.data)})},clearSearch:function(){this.searchTextArea.setValue("");this.searchTextArea.setOption("lineNumbers",!1)},tail:function(){this.isTailing?(this.isTailing=!1,this.currByte="0",d.byId("tailLogButton").innerHTML="Start Tail",b.byId("tailFilter").set("disabled",
!1)):(this.isTailing=!0,this.refreshTailInfo(),d.byId("tailLogButton").innerHTML="Stop Tail",b.byId("tailFilter").set("disabled",!0))},refreshTailInfo:function(){if(this.isTailing){var a=this,b=net.apachegui.Util.getQueryParam("file");e.get("../web/Logs",{query:{option:"tail",currByte:this.currByte,filter:d.byId("tailFilter").value,file:b},handleAs:"text",sync:!1,preventCache:!0}).response.then(function(b){null!=b.getHeader("currByte")&&(a.currByte=b.getHeader("currByte"));b=b.data;""!=b&&(a.getTailTextArea().setValue(a.getTailTextArea().getValue()+
b),a.getTailTextArea().setOption("lineNumbers",!0),a.getTailTextArea().setCursor(a.getTailTextArea().lineCount(),0));setTimeout(a.refreshTailInfo.bind(a),3E3)},function(a){net.apachegui.Util.alert("Info",a.response.data)})}},clearTail:function(){this.tailTextArea.setValue("");this.tailTextArea.setOption("lineNumbers",!1)},exportToFile:function(){var a=net.apachegui.Util.noCloseDialog("Generating","Generating File Please Wait...");a.show();var b=net.apachegui.Util.getQueryParam("file"),c=d.byId("searchFilter").value;
e.get("../web/Logs",{query:{option:"export",searchFilter:c,file:b},handleAs:"json",sync:!1,preventCache:!0}).response.then(function(b){window.location.href="../web/DownloadFile?file\x3d"+b.data.file;a.remove()},function(b){a.remove();net.apachegui.Util.alert("Info",b.response.data.message)})},addListeners:function(){var a=this;c(b.byId("searchButton"),"click",function(){a.search()});c(b.byId("searchClearButton"),"click",function(){a.clearSearch()});c(b.byId("searchExportButton"),"click",function(){a.exportToFile()});
c(b.byId("tailLogButton"),"click",function(){a.tail()});c(b.byId("clearTailLogButton"),"click",function(){a.clearTail()});c(b.byId("logAction"),"change",function(){a.updateSelection()})}});net.apachegui.Util.setupSingletonInstance(net.apachegui.Logs)});